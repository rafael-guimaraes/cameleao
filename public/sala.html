<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camaleão</title>
    
</head>
<body>
    <h1>Bem-vindo à sala!</h1>
    <p>Compartilhe este link com outros para convidá-los para esta sala:</p>
    <p id="idSala"></p>
    <p id="chefeSala"></p>
    <div id="listaUsuarios"></div>
    <button id="sairSalaBtn">Sair da Sala</button>
    <button id="iniciarPartidaBtn" style="display:none;">Iniciar Partida</button>   
    <div id="opcaoTexto" style="display:none;">
        <div id="timer" style="display:none;">Tempo restante: <span id="tempoRestante"></span></div>
        <input type="text" id="textoInput" placeholder="Lugar da rodada..." autocomplete="off">
        <button id="enviarTextoBtn">Enviar</button>
    </div>
    <div id="informacaoRodada"> 

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
    <script>
        const socket = io();

        const urlParams = new URLSearchParams(window.location.search);
        const idSala = urlParams.get('id');
        let nomeUsuario = prompt('Por favor, digite seu nome:'); 

        if (!idSala || !nomeUsuario) {
            alert('ID da sala ou nome de usuário inválido. Redirecionando para a página principal.');
            window.location.href = 'index.html';
        }
        
        socket.emit('entrar_sala', { id_sala: idSala, nome_usuario: nomeUsuario }); 

        document.getElementById('idSala').innerText = `ID da Sala: ${idSala} | Usuário: ${nomeUsuario}` ;
            
        socket.on('erro', (mensagem) => {
            alert(mensagem);
            window.location.href = 'index.html';
        });
        
        document.getElementById('iniciarPartidaBtn').addEventListener('click', () => {
            socket.emit('iniciar_rodada', idSala); 
        });

        document.getElementById('sairSalaBtn').addEventListener('click', () => {
            socket.emit('sair_sala'); 
            window.location.href = 'index.html';
        });

        socket.on('sala_entrar', (salaInfo) => { 
            document.getElementById('chefeSala').innerText = `Dono da Sala: ${salaInfo.dono.nome}`;
        });

        socket.on('camaleao', () => {
            document.getElementById('opcaoTexto').style.display = 'none';
            document.getElementById('informacaoRodada').innerText = 'Você é o camaleão';
            document.getElementById('informacaoRodada').style.display = 'block';
        });

        socket.on('tema_rodada', (temaRodada) => { // Alterei para 'tema_rodada'
            document.getElementById('opcaoTexto').style.display = 'none';
            console.log(temaRodada);
            document.getElementById('informacaoRodada').innerText = `O tema da rodada é: ${temaRodada}`;
            document.getElementById('informacaoRodada').style.display = 'block';
        });
        
        socket.on('lista_usuarios', (usuarios) => { // Alterei para 'lista_usuarios'
            const listaUsuarios = document.getElementById('listaUsuarios');
            listaUsuarios.innerHTML = '<h3>Usuários Conectados:</h3>';
            let usuarioChefe = false;

            usuarios.forEach(usuario => {
                const usuarioItem = document.createElement('div');
                usuarioItem.textContent = usuario.nome;
                if (usuario.dono) {
                    usuarioItem.style.fontWeight = 'bold'; 
                    if (usuario.id === socket.id) {
                        usuarioChefe = true;
                    }
                }
                listaUsuarios.appendChild(usuarioItem);
            });

            const botaoIniciarPartida = document.getElementById('iniciarPartidaBtn');
            if (usuarioChefe) {
                botaoIniciarPartida.style.display = 'block'; 
            } else {
                botaoIniciarPartida.style.display = 'none'; 
            }
        });

        socket.on('rodada_iniciada', (tempoRestante) => { // Alterei para 'rodada_iniciada'
            document.getElementById('timer').style.display = 'block';
            document.getElementById('opcaoTexto').style.display = 'block';
            document.getElementById('tempoRestante').textContent = tempoRestante;
        });

        document.getElementById('enviarTextoBtn').addEventListener('click', () => {
            const texto = document.getElementById('textoInput').value;
            socket.emit('enviar_tema', texto); // Alterei para 'enviar_tema'
        });

        socket.on('atualizar_tempo', (tempoRestante) => { // Alterei para 'atualizar_tempo'
            document.getElementById('tempoRestante').textContent = tempoRestante;
        });

        socket.on('disconnect', () => {
            alert('Você foi desconectado do servidor.');
            window.location.href = 'index.html';
        });

    </script>
</body>
</html>
